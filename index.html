<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Escape Room Game</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    <script>
        AFRAME.registerComponent('timer', {
            init: function () {
            var timerText = this.el;
            var initialTime = 5 * 60; // 5 minutes in seconds
            var timerRunning = false;
            var interval;

            function updateTimer() {
                var minutes = Math.floor(initialTime / 60);
                var seconds = initialTime % 60;
                var formattedTime = ('0' + minutes).slice(-2) + ':' + ('0' + seconds).slice(-2);
                timerText.setAttribute('text', 'value', formattedTime);

                if (initialTime > 0) {
                    initialTime--;
                } else {
                    clearInterval(interval);
                    timerText.setAttribute('text', 'value', 'Time is up!');
                    timerText.setAttribute('text', 'color', 'red');

                    // attempts to create a "you lose" screen
                    var scene = document.querySelector('a-scene');
                    //scene.setAttribute('background', 'color: black');
                    //scene.setAttribute('environment', 'preset', 'black');
                    showEndMessage();

                    // var scene = document.querySelector('a-scene');
                    //scene.setAttribute('environment', 'preset', 'white');
                    // var scene = document.querySelector('a-scene');
                    var camera = document.querySelector('[camera]');

                    // Disabling camera controls after time is up
                    camera.removeAttribute('look-controls');
                    camera.removeAttribute('wasd-controls');                   
                }
            }

            function showEndMessage() {
                        endMessage = document.createElement('a-entity');
                        endMessage.setAttribute('text', {
                            value: 'Time is up! You lose!',
                            color: 'red',
                            align: 'center',
                            width: 5
                        });
                        endMessage.setAttribute('position', '0 0 -4');
                        document.querySelector('a-camera').appendChild(endMessage);
                        endMessage.setAttribute('look-at', '[camera]');
                    }

            document.addEventListener('keydown', function (event) {
                if (event.code === 'Space') {
                    if (!timerRunning) {
                        interval = setInterval(updateTimer, 1000);
                        timerRunning = true;
                    }
                }
            });
            }
        });

        AFRAME.registerComponent('change-text', {
            init: function () {
                var el = this.el;

                document.addEventListener('keydown', function (event) {
                    if (event.code === 'Space') {
                        // Change the text of the introduction box
                        introBox.setAttribute('text', 'value', "To unravel the secrets veiled in art, gaze upon painting, and play your part. Her enigmatic smile hides a key, seek the brushstrokes, and you will see. In shadows deep, where colors blend, a message waits for you to send. When time stands still and the room falls hush, decode the masterpiece with a patient touch. Let your eyes dance on her painted grace, and you'll find the key to unlock the next space.");
                    }
                });
            }
        });

        AFRAME.registerComponent('rotate-on-click', {
            schema: {
                paintingId: {type: 'string', default: ''}
            },
            
            init: function () {
                var el = this.el;
                var rotationThreshold = -90; // Define the rotation threshold
                var paintingId = this.data.paintingId;

                // Add click event listener to the painting
                el.addEventListener('click', function () {
                    var currentRotation = el.getAttribute('rotation');
                    var newRotation = currentRotation.z - 90;

                // Move the painting back behind the wall
                el.setAttribute('rotation', {
                    x: currentRotation.x,
                    y: currentRotation.y,
                    z: newRotation
                });

                // Check if the rotation reaches the threshold
                if (paintingId === 'monaLisa' && newRotation <= rotationThreshold) {
                    showText();
                    introBox.setAttribute('text', 'value', "congrats on finding the first key! you sure have Won the lottery. To the safe where the next clue lies. you will need to escape, beFore time runs out. Or else it will be Too lAte!");
                }
            });

            function showText() {
                var text = document.createElement('a-entity');
                text.setAttribute('text', {
                    value: 'You found the first key! Go back to the start for your next clue!',
                    color: 'white',
                    align: 'center',
                    width: 3
                })
                var camera = document.querySelector('[camera]');
                var cameraPosition = camera.getAttribute('position');
                text.setAttribute('position', '-7.5 3 .5'); // Adjust position as needed
                text.setAttribute('rotation', '0 90 0');
                document.querySelector('a-scene').appendChild(text);
            }
        }
    });

    AFRAME.registerComponent('lamp-light', { 
            init: function () {
                // Get references to the lamp components
                const stand = this.el;
                const lightSource = this.el.querySelector('#light-source');

                // Boolean variable to track light status
                let isLightOn = false;
                lightSource.setAttribute('light', 'intensity', 0);

                // Function to toggle the light
                const toggleLight = () => {
                    if (isLightOn) {
                        // Turn off the light
                        lightSource.setAttribute('light', 'intensity', 0);
                        hideText();
                    } else {
                        // Turn on the light
                        lightSource.setAttribute('light', 'intensity', 0.9);
                        revealText();
                    }
                    // Invert the light status
                    isLightOn = !isLightOn;
                };

                // Add click event listener to the lamp stand
                stand.addEventListener('click', toggleLight);

                function revealText() {
                    const text = document.createElement('a-entity');
                    text.setAttribute('id', 'lampText');
                    text.setAttribute('text', {
                        value: '"A reader lives a thousand lives before he dies . . . The man who never reads lives only one." - George R R Martin',
                        color: 'black',
                        align: 'center',
                        width: 3
                    })
                    text.setAttribute('position', '-3 3.4 7.7'); // Adjust position as needed
                    text.setAttribute('rotation', '0 180 0');
                    document.querySelector('a-scene').appendChild(text);
                }

                function hideText() {
                    const existingText = document.getElementById('lampText');
                    if (existingText) {
                        existingText.parentNode.removeChild(existingText);
                    }
                }
            }
    });

    </script>    
    </head>
    <body>
    <a-scene background="color: white">
        <a-entity environment="preset: forest; dressingAmount: 100"></a-entity>
        
        <!-- Floor -->
        <a-plane position="0 0.09 0" rotation="-90 0 0" width="16" height="16" repeat="4 2" color="#A36846"></a-plane>

        <!-- Walls -->
        <a-box position="0 0.3 -8" rotation="0 0 0" scale="16 12 0.2" color="#a1a1a1"></a-box>
        <a-box position="8 0.3 0" rotation="0 90 0" scale="16 12 0.2" color="#a1a1a1"></a-box>
        <a-box position="0 0.3 8" rotation="0 0 0" scale="16 12 0.2" color="#a1a1a1"></a-box>
        <a-box position="-8 0.3 0" rotation="0 90 0" scale="16 12 0.2" color="#a1a1a1"></a-box>

        <!-- Door -->
        <a-box position="0 0.3 -7.99" rotation="0 0 0" scale="1.5 4.5 0.2" color="#6E260E"></a-box>
        <a-sphere position= "-.5 1.15 -7.9" color="yellow" radius="0.1" radius="5"></a-sphere>

        <!-- Ceiling -->
        <a-plane position="0 6 0" rotation="90 0 0" width="16" height="16" repeat="4 2" color="#a1a1a1"></a-plane>

        <!-- Ambient Light -->
        <a-light type="ambient" color="#888" intensity="0.8"></a-light>

        <!-- Point Lights -->
        <a-light type="point" color="#888" intensity="0.25" position="7 5.8 7"></a-light>
        <a-light type="point" color="#888" intensity="0.25" position="7 5.8 -7"></a-light>
        <a-light type="point" color="#888" intensity="0.25" position="-7 5.8 -7"></a-light>
        <a-light type="point" color="#888" intensity="0.25" position="-7 5.8 7"></a-light>

        <!-- Text box background plane -->
        <a-plane rotation="0 0 0" width="3.3" height="2" position="0 1.95 -4" repeat="4 2" color="black"></a-plane>    
        <!-- Introduction box -->
        <a-text id="introBox" value="Introduction:
        
        You just woke up in your room and realized someone locked you inside. 
        In order to get out, you have to follow clues to find keys that will unlock the door. 
        Make sure you work fast before time runs out.
        Click and drag to look around, and use the WASD keys to move around the room.
        To get started press the space button." color="white" width="3" height="4" position="-1.5 2 -4" change-text></a-text>

        <!-- A-Frame Bed -->
       <a-entity position="0 0.2 5.5" rotation="0 180 0">

        <!-- Bed Frame -->
        <a-box width="4" height="0.2" depth="4" color="#8B4513"></a-box>

        <!-- Headboard -->
        <a-box width="4" height="2" depth="0.2" position="0 0 -2" color="#8B4513"></a-box>

        <!-- Mattress -->
        <a-box width="3.5" height="0.4" depth="3.5" position="0 0.1 0" color="#6495ED"></a-box>

        <!-- Pillows -->
        <a-entity position="0.8 0.25 -1.5">
        <a-box width="1.5" height="0.3" depth="0.5" color="#FFD700"></a-box>
        </a-entity>
        <a-entity position="-0.8 0.25 -1.5">
        <a-box width="1.5" height="0.3" depth="0.5" color="#FFD700"></a-box>
        </a-entity>
        </a-entity>

        <!-- Mona Lisa Painting on the wall -->
        <a-plane position="-7.88 3 .5" rotation="0 90 0" width="2" height="4" color="white" src="Leonardo_da_Vinci_-_Mona_Lisa.jpg" rotate-on-click="paintingId: monaLisa"></a-plane>

        <!-- Key on the wall -->
        <a-plane position="-7.89 4.5 0" rotation="0 90 0" width="1" height=".5" src="key.png"></a-plane>

        <!-- Flower Painting on the wall -->
        <a-plane position="-7.89 3 5" rotation="0 90 0" width="2" height="4" color="white" src="flowerpainting.jpg" rotate-on-click></a-plane>

        <!-- Van Gogh Painting on the wall -->
        <a-plane position="-7.89 3 -4" rotation="0 90 0" width="2" height="4" color="white" src="vangoghmuseum-s0016V1962-800.jpg" rotate-on-click></a-plane>
        
        <!-- Timer -->
        <a-text value="Timer:" color="black" width="3" height="4" position="-0.5 3.2 -4"></a-text>
        <a-entity id="timerText" position="1.4 3.2 -4" text="value: 05:00; color: black; width: 3; height: 4;" timer></a-entity>
        
        <!-- Camera with wasd-controls -->
        <a-entity id='camera' camera look-controls wasd-controls="acceleration: 50" position="0 1.6 0">
            <a-cursor></a-cursor>
        </a-entity>

        <!-- Drawers for nighstand -->
        <a-box position="-3 0.75 7" width="1.4" height="0.4" depth="0.6" color="#8B4513"></a-box>
        <a-box position="-3 0.35 7" width="1.4" height="0.4" depth="0.6" color="#8B4513"></a-box>
        <a-box position="-3 -0.05 7" width="1.4" height="0.4" depth="0.6" color="#8B4513"></a-box>

        <!-- Handles for nighstand drawers -->
        <a-cylinder position="-3 0.90 6.78" rotation="90 0 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>
        <a-cylinder position="-3 0.55 6.78" rotation="90 0 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>
        <a-cylinder position="-3 0.20 6.78" rotation="90 0 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>

        <!-- Clock -->
        <a-entity position="6 4 -4.4" rotation="0 0 90">
        <!-- Hour Hand -->
        <a-box position="0.2 1.5 -3.3" width="0.05" height="0.6" depth="0.05" rotation="0 0 75" color="black"></a-box>

        <!-- Minute Hand -->
        <a-box position="0 1.7 -3.3" width="0.05" height="0.6" depth="0.03" rotation="0 0 180" color="black"></a-box>

        <!-- Clock Base -->
        <a-cylinder position="0 1.5 -3.5" radius="0.8" height="0.1" color="black" rotation="0 90 90"></a-cylinder>
        <a-cylinder position="0 1.5 -3.4" radius="0.6" height="0.1" color="white" rotation="0 90 90"></a-cylinder>
        </a-entity>

        <a-entity id="lamp-light" lamp-light>
            <!-- Lamp Stand -->
            <a-cylinder position="-3 1 7" radius="0.1" height="1.9" color="gray"></a-cylinder>
            
            <!-- Lamp Shade -->
            <a-cone position="-3 2 7" radius-bottom="0.5" radius-top="0" height="1" color="white"></a-cone>
             
            <!-- Light Source (Sphere) -->
            <a-sphere id="light-source" position="-3 2.5 7" radius="0.2" color="blue" light="type: point; intensity: 0.9; color: blue"></a-sphere>
        </a-entity>

        <!-- Drawers for dresser -->
        <a-box position="7.5 0.75 7" rotation="0 90 0" width="1.75" height="0.6" depth="0.6" color="#8B4513"></a-box>
        <a-box position="7.5 0.35 7" rotation="0 90 0" width="1.75" height="0.6" depth="0.6" color="#8B4513"></a-box>
        <a-box position="7.5 -0.05 7" rotation="0 90 0" width="1.75" height="0.6" depth="0.6" color="#8B4513"></a-box>

        <a-box position="7.5 0.75 5.25" rotation="0 90 0" width="1.75" height="0.6" depth="0.6" color="#8B4513"></a-box>
        <a-box position="7.5 0.35 5.25" rotation="0 90 0" width="1.75" height="0.6" depth="0.6" color="#8B4513"></a-box>
        <a-box position="7.5 -0.05 5.25" rotation="0 90 0" width="1.75" height="0.6" depth="0.6" color="#8B4513"></a-box>


        <!-- Handles for dresser -->
        <a-cylinder position="7.28 0.90 7" rotation="90 90 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>
        <a-cylinder position="7.28 0.55 7" rotation="90 90 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>
        <a-cylinder position="7.28 0.20 7" rotation="90 90 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>

        <a-cylinder position="7.28 0.90 5.25" rotation="90 90 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>
        <a-cylinder position="7.28 0.55 5.25" rotation="90 90 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>
        <a-cylinder position="7.28 0.20 5.25" rotation="90 90 0" radius="0.04" height="0.2" color="#FFED8A"></a-cylinder>


    </a-scene>
</body>
</html>